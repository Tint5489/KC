<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Books â€“ Editable Table</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .table-wrap { overflow:auto; }
    th.sticky { position: sticky; top: 0; background: white; z-index: 1; }
    td.title-col input { width: 100%; } 
    td.usb-col input { width: 100%; }
    td input, td select { margin: 1px; padding: 2px; } 
    table { border-collapse: collapse; } 
    td, th { border: 1px solid #e2e8f0; } 
    .resizer {
      position: absolute;
      top: 0;
      right: 0;
      width: 5px;
      cursor: col-resize;
      user-select: none;
      height: 100%;
    }
    th { position: relative; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div class="max-w-7xl mx-auto p-4 md:p-6">
    <header class="mb-4 md:mb-6">
      <h1 class="text-2xl md:text-3xl font-bold">ðŸ“š My Books â€“ Editable Table</h1>
      <p class="text-sm text-slate-600 mt-1">Inline-edit your list, save in your browser, or export/share.</p>
      <div class="mt-4 flex gap-2 flex-wrap">
        <button id="addRow" class="rounded-lg bg-blue-600 text-white px-3 py-1 shadow">+ Add Row</button>
        <button id="exportCsv" class="rounded-lg bg-green-600 text-white px-3 py-1 shadow">â¬‡ Export CSV</button>
        <label class="rounded-lg bg-purple-600 text-white px-3 py-1 shadow cursor-pointer">
          â¬† Import CSV<input id="importCsv" type="file" accept=".csv" class="hidden" />
        </label>
        <button id="resetTable" class="rounded-lg bg-red-600 text-white px-3 py-1 shadow">Reset to Seed</button>
      </div>
    </header>

    <div class="table-wrap rounded-2xl border border-slate-200 shadow-sm bg-white">
      <table class="min-w-full text-sm" id="bookTable">
        <thead>
          <tr class="*:[&>th]:px-1 *:[&>th]:py-1 *:[&>th]:text-left border-b">
            <th>Title</th>
            <th>Author</th>
            <th>Read Status</th>
            <th>USB</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="tbody" class="divide-y"></tbody>
      </table>
    </div>
  </div>

  <script>
    const seed = [
      {title:" ", author:" ", status:" ", usb:""},
      
    ];

    const STORAGE_KEY = 'booklist-v1';
    let rows = [];

    function render() {
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = '';
      rows.forEach(r => {
        const tr = document.createElement('tr');
        tr.className = "*:[&>td]:px-1 *:[&>td]:py-1 align-top";
        tr.appendChild(tdInput('title', r, 'title-col'));
        tr.appendChild(tdInput('author', r));
        tr.appendChild(tdStatus(r));
        tr.appendChild(tdInput('usb', r, 'usb-col'));
        tr.appendChild(tdActions(r));
        tbody.appendChild(tr);
      });
    }

    function tdInput(key, r, extraClass='') {
      const td = document.createElement('td');
      if(extraClass) td.classList.add(extraClass);
      const inp = document.createElement('input');
      inp.type = 'text';
      inp.value = r[key]||'';
      inp.className = 'rounded-lg border border-slate-300 px-1 py-1 w-full';
      inp.addEventListener('change', e => { r[key] = e.target.value; saveAuto(); });
      td.appendChild(inp);
      return td;
    }

    function tdStatus(r) {
      const td = document.createElement('td');
      const sel = document.createElement('select');
      sel.className = 'w-full rounded-lg border border-slate-300 px-1 py-1';
      ['Unread','Reading','Read'].forEach(opt=>{
        const o = document.createElement('option'); o.textContent = opt; o.value = opt;
        if (r.status===opt) o.selected = true;
        sel.appendChild(o);
      });
      sel.addEventListener('change', e=>{ r.status = e.target.value; saveAuto(); });
      td.appendChild(sel);
      return td;
    }

    function tdActions(r) {
      const td = document.createElement('td');
      const del = document.createElement('button');
      del.textContent = 'Delete';
      del.className = 'rounded-lg border px-1 py-1';
      del.addEventListener('click', ()=>{
        const i = rows.indexOf(r);
        if (i>-1) rows.splice(i,1);
        saveAuto(); render();
      });
      td.appendChild(del);
      return td;
    }

    function saveAuto(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(rows)); }
    function addRow(){ rows.push({title:'',author:'',status:'Unread',usb:''}); saveAuto(); render(); }

    function exportCsv() {
      const header = ["Title", "Author", "Read Status", "USB"];
      const rowsData = rows.map(r => [r.title||"", r.author||"", r.status||"", r.usb||""]);
      const escapeCell = (cell) => {
        const c = String(cell);
        return (c.includes('"') || c.includes(',') || c.includes('\n')) ? `"${c.replace(/"/g,'""')}"` : c;
      };
      const csvText = [header.join(','), ...rowsData.map(r => r.map(escapeCell).join(','))].join('\n');
      const blob = new Blob([csvText], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'books.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importCsv(file){
      const reader = new FileReader();
      reader.onload = e => {
        const text = e.target.result;
        const lines = text.split(/\r?\n/).filter(l=>l.trim().length);
        lines.shift();
        rows = lines.map(l => {
          const cols = l.match(/\"([^\"]*(?:\"\"[^\"]*)*)\"/g)?.map(s=>s.slice(1,-1).replace(/\"\"/g,'"')) || l.split(",");
          return { title: cols[0]||'', author: cols[1]||'', status: cols[2]||'Unread', usb: cols[3]||'' };
        });
        saveAuto(); render();
      };
      reader.readAsText(file);
    }

    function resetTable(){ rows = seed.slice(); saveAuto(); render(); }

    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      rows = saved ? JSON.parse(saved) : seed.slice();
    } catch { rows = seed.slice(); }

    saveAuto(); render();

    document.getElementById('addRow').addEventListener('click', addRow);
    document.getElementById('exportCsv').addEventListener('click', exportCsv);
    document.getElementById('resetTable').addEventListener('click', resetTable);
    document.getElementById('importCsv').addEventListener('change', e=>{
      if (e.target.files.length) importCsv(e.target.files[0]);
      e.target.value = '';
    });

    // Make columns resizable
    function makeResizable(table) {
      const cols = table.querySelectorAll('th');
      cols.forEach(th => {
        const grip = document.createElement('div');
        grip.className = 'resizer';
        grip.addEventListener('mousedown', initResize);
        th.appendChild(grip);

        function initResize(e) {
          e.preventDefault();
          document.addEventListener('mousemove', onMouseMove);
          document.addEventListener('mouseup', onMouseUp);
          const startX = e.pageX;
          const startWidth = th.offsetWidth;

          function onMouseMove(e) {
            const newWidth = startWidth + (e.pageX - startX);
            th.style.width = newWidth + 'px';
          }

          function onMouseUp() {
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
          }
        }
      });
    }

    makeResizable(document.getElementById('bookTable'));
  </script>
</body>
</html>
